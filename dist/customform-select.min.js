!function(l){"use strict";l.CustomFormSelect=function(t,e){return this.customForm=t,l.extend(l.CustomFormSelect.prototype,l.CustomForm.prototype),this.elements={body:l("body"),context:this.customForm.elementContext,input:this.customForm.elementInput,wrapper:null,wrapperInput:null,source:{options:null,optgroups:null},wrapperLabel:null,wrapperOptions:null},l.extend(!0,this.settings={},this.customForm.settings,l.CustomFormSelect.defaults,e),this.type=this.customForm.support.type,this.multiple=this.getInput().prop("multiple"),this.multipleOptions=[],this.keyboard={timeout:null,search:[],options:{}},this.prepareUserOptions()&&this.init(),this},l.CustomFormSelect.defaults={classes:{label:"{prefix}-select-label",toggle:"{prefix}-select-toggle",content:"{prefix}-select-content",options:"{prefix}-select-options",option:"{prefix}-select-option",optionGroup:"{prefix}-select-optiongroup",optionGroupLabel:"{prefix}-select-optiongroup-label",first:"is-first",last:"is-last",selected:"is-selected",focused:"is-focused",multiple:"is-multiple",open:"is-open"},multipleOptionsSeparator:", ",beforeLoad:void 0,beforeWrap:void 0,afterEventsHandler:void 0,onComplete:void 0,onClick:void 0,onChange:void 0,onReset:void 0},l.CustomFormSelect.prototype={init:function(){return void 0!==this.settings.beforeLoad&&this.settings.beforeLoad.call({customFormSelect:this,elements:this.getElements()}),this.wrap(),this.reset(),this.eventsHandler(),void 0!==this.settings.onComplete&&this.settings.onComplete.call({customFormSelect:this,elements:this.getElements()}),this},wrap:function(){var o=this;o.elements.wrapper=l("<div>",{class:o.settings.classes.prefix+" "+o.settings.classes.prefix+"--"+o.getInputType()}),o.elements.wrapperInput=l("<div>",{class:o.settings.classes.input}),void 0!==o.settings.beforeWrap&&o.settings.beforeWrap.call({customForm:o,elements:o.getElements()}),o.getInput().parent().wrapInner(o.getWrapper()),o.elements.wrapper=o.getInput().parent(),o.getInput().wrap(o.getWrapperInput()),o.elements.wrapperInput=o.getInput().parent(),o.elements.source.options=o.getInput().children("option"),o.elements.source.optgroups=o.getInput().children("optgroup"),o.getWrapperInput().append(l("<div>",{class:o.settings.classes.label})),o.elements.wrapperLabel=o.getInput().next(),o.elements.toggle=l("<button>",{class:o.settings.classes.toggle,type:"button","aria-expanded":!0}),o.isDisabled()||o.elements.toggle.attr("tabindex",o.settings.tabindexStart),o.getWrapperLabel().append(o.elements.toggle),o.getWrapperInput().append(l("<div>",{class:o.settings.classes.content})),o.elements.wrapperContent=o.getWrapperLabel().next(),o.elements.wrapperOptions=l("<ul>",{class:o.settings.classes.options,tabindex:-1}).appendTo(o.elements.wrapperContent);var t=o.getInput().attr("id"),e=o.getInput().attr("name"),n={};void 0!==t&&(n.id=t),void 0!==e&&(n.name=e);return o.getInput().remove(),o.elements.defaultInput=l("<input>",{type:"hidden",tabindex:-1,"aria-hidden":!0}),o.elements.defaultInput.prependTo(o.getWrapperInput()),o.isMultiple()&&o.getWrapper().addClass(o.settings.classes.multiple),o.getSourceOptions().length&&l.each(o.getSourceOptions(),function(t,e){e=l(e),o.getWrapperOptions().append(o.wrapOption(t,e,n))}),o.getSourceOptgroups().length&&l.each(o.getSourceOptgroups(),function(t,e){e=l(e);var s=l("<ul>",{class:o.settings.classes.optionGroup});l("<li>",{class:o.settings.classes.optionGroupLabel,html:e.attr("label")}).appendTo(s),e.children("option").each(function(t,e){e=l(e),s.append(o.wrapOption(t,e,n))}),o.getWrapperOptions().append(l("<li>",{html:s}))}),o.getOptions().first().addClass(o.settings.classes.first).end().last().addClass(o.settings.classes.last),o},wrapOption:function(t,e,s){var o=e.attr("class"),n=void 0!==e.attr("disabled"),i=l("<li>",{class:this.settings.classes.option+(void 0!==o?" "+o:"")+(n?" "+this.settings.classes.disabled:"")});return s.class=this.settings.classes.option+"-input",s.value=e.val(),s.type=this.isMultiple()?"checkbox":"radio",s.tabindex=-1,l("<input>",s).appendTo(i),l("<label>",{class:this.settings.classes.option+"-label",html:e.html()}).appendTo(i),i},reset:function(){var s,t,e=this,i=e.getDefaultValue();return e.getWrapper().removeClass(e.settings.classes.disabled+" "+e.settings.classes.required),e.isDisabled()&&e.getWrapper().addClass(e.settings.classes.disabled),e.isRequired()&&e.getWrapper().addClass(e.settings.classes.required),void 0===i&&(0===(i=e.getSourceOptions().filter("[selected]")).length&&(i=e.getSourceOptions().first()),i=1<i.length?(s=[],l.each(i,function(t,e){s.push(l(e).val())}),s.join(",")):(e.setLabel(i.html()),i.val()),e.getDefaultInput().val(i)),e.isMultiple()&&(t=e.loadOption("."+e.settings.classes.first),i===t.getValue()&&(i=null,e.setLabel(t.getName()))),e.getOptions().each(function(t,s){var o=(s=e.loadOption(s)).getValue(),n={context:"init"};e.isMultiple()&&null!==i?("string"==typeof i&&(i=i.split(",")),s.unselect(),l.each(i,function(t,e){o===e&&s.select(n)})):o===i&&s.select(n)}),e},eventsHandler:function(){var e=this,s=void 0;e.getToggleBtn().on("click.customform.open keydown.customform.open",function(t){e.isDisabled()||(clearTimeout(s),s=setTimeout(function(){"click"===t.type||"keydown"===t.type&&"Enter"===t.key?e.clickHandler(t):"keydown"===t.type&&e.keyboardHandler(t)},100),"keydown"!==t.type||"ArrowUp"!==t.key&&"ArrowDown"!==t.key&&"Space"!==t.key||t.preventDefault())}),e.getWrapperOptions().on("keydown.customform.options",function(t){e.keyboardHandler(t)}),e.getContext().on("reset.customform",function(t){e.onReady(function(){e.reset(),void 0!==e.settings.onReset&&e.settings.onReset.call({customFormSelect:e,form:l(t.currentTarget)})})}),void 0!==e.settings.afterEventsHandler&&e.settings.afterEventsHandler.call({customFormSelect:e,elements:e.getElements()})},clickHandler:function(t){var o=this,e=void 0;o.closeSiblings(),o.getToggleBtn().focus().on("click.customform.close keydown.customform.close",function(t){clearTimeout(e),e=setTimeout(function(){("click"===t.type||"keydown"===t.type&&"Enter"===t.key)&&o.close()},100)}),o.getElements().body.on("click.customform.close",function(t){var e=l(t.target),s=e.hasClass(o.settings.classes.option)||e.hasClass(o.settings.classes.option+"-input")||e.hasClass(o.settings.classes.option+"-label");(!o.isMultiple()&&s||!e.hasClass(o.settings.classes.toggle)&&!s)&&o.close()}),o.getWrapper().addClass(o.settings.classes.open),o.getOptions().on("click.customform.option",function(t){o.loadOption(t.currentTarget).select({context:t.type})}).each(function(t,e){e=o.loadOption(e),o.isDisabled()||e.isDisabled()||e.getOption().attr("tabindex",o.settings.tabindexStart)}),void 0!==o.settings.onClick&&o.settings.onClick.call({customFormSelect:o,event:t,elements:o.getElements(),options:o.getOptions()})},keyboardHandler:function(t){var s=this,e=null,o=0,n=0,i="Enter"===t.key,l="Space"===t.key||" "===t.key||void 0!==t.keyCode&&32===t.keyCode,r=t.shiftKey&&"Tab"===t.key&&s.isOpen(),p=!t.shiftKey&&"Tab"===t.key&&s.isOpen(),c="ArrowUp"===t.key||"ArrowLeft"===t.key||r?"up":"ArrowDown"===t.key||"ArrowRight"===t.key||p?"down":void 0,a="PageDown"===t.key||t.metaKey&&"down"===c?"last":"PageUp"===t.key||t.metaKey&&"up"===c?"first":void 0,u=("Escape"===t.key||i)&&s.isOpen(),g=/[a-z0-9\-_]/i.test(t.key);if(l||i)return t.preventDefault(),void(s.isMultiple()&&(e=s.getOptions("."+s.settings.classes.focused),s.isOpen()&&e.length&&(e=s.loadOption(e)).select()));u?setTimeout(function(){s.close()},100):(s.getOptions().each(function(t,e){e=s.loadOption(e),s.keyboard.options[t]=e,s.isMultiple()?e.hasState("focused")&&(o=t):e.isSelected()&&(o=t),n++}),void 0===c&&void 0===a||(t.preventDefault(),s.closeSiblings(),void 0!==a?e="last"===(c=a)?s.keyboard.options[n-1]:s.isMultiple()?s.keyboard.options[1]:s.keyboard.options[0]:"up"===c?e=s.keyboard.options[o-1]:"down"===c&&(e=s.keyboard.options[o+1]),null!=e&&(e[s.isMultiple()?"focus":"select"]({context:"keydown",direction:c}),s.isOpen()?s.autoscrollWrapperOptions(e,c):s.isMultiple()&&s.clickHandler())),g&&(clearTimeout(s.keyboard.timeout),s.keyboard.search.push(t.key),s.keyboard.timeout=setTimeout(function(){null!==(e=s.getOptionOnkeyboard())&&e.select({context:"keydown"})},250)))},getOptionOnkeyboard:function(){var s=this,t=null,o=this.keyboard.search.join(""),n=[],i=[];return s.getOptions().each(function(t,e){e=s.loadOption(e),n.push(e.getName().toLowerCase().indexOf(o))}),n.length&&l.each(n,function(t,e){-1!==e&&i.push(t)}),i.length&&(i=i.shift(),"object"==typeof s.keyboard.options[i]&&(t=s.keyboard.options[i])),s.keyboard.search=[],t},autoscrollWrapperOptions:function(t,e){var s,o,n,i,l,r=this;"first"===e||"last"===e?r.getWrapperOptions().scrollTop("first"===e?0:r.getWrapperOptions()[0].scrollHeight):(s=parseInt(t.getOption().position().top),o=parseInt(r.getWrapperOptions().scrollTop()),i=!1,Math.round(r.getWrapperOptions().outerHeight())-(n=Math.round(t.getOption().outerHeight()))<s?(r.getWrapperOptions().scrollTop(o+n),i=!0):s<0&&(r.getWrapperOptions().scrollTop(o-n),i=!0),!i||(l=r.loadOption(t.getOption()["up"===e?"prev":"next"]())).getOption().length&&l.isDisabled()&&r.autoscrollWrapperOptions(l,e))},close:function(t){var s=void 0!==t&&void 0!==t.data&&void 0!==t.data.self?t.data.self:this;return s.getWrapper().removeClass(s.settings.classes.open),s.getToggleBtn().focus().off("click.customform.close keydown.customform.close"),s.getOptions().off("click.customform.option").each(function(t,e){(e=s.loadOption(e)).getOption().attr("tabindex",-1)}),s.getElements().body.off("click.customform.close"),void 0!==s.settings.onClose&&s.settings.onClose.call({customFormSelect:s}),s},closeSiblings:function(){var s=this,t=s.getSiblings();return t.length&&t.each(function(t,e){l(e).removeClass(s.settings.classes.open).find("."+s.settings.classes.toggle).off("click.customform.close keydown.customform.close").end().find("."+s.settings.classes.option).off("click.customform.option")}),s},setLabel:function(t){return this.isMultiple()&&"object"==typeof t&&(t=t.join(this.settings.multipleOptionsSeparator)),this.getToggleBtn().html(t),this},isMultiple:function(){return this.multiple},isOpen:function(){return this.getWrapper().hasClass(this.settings.classes.open)},getSiblings:function(){return this.getContext().find("."+this.settings.classes.prefix+"--"+this.getInputType()).not(this.getWrapper())},getWrapperLabel:function(){return this.getElements().wrapperLabel},getToggleBtn:function(){return this.getElements().toggle},getDefaultInput:function(){return this.getElements().defaultInput},getCurrentValue:function(){var s=this,o=[],t=s.getOptions("."+s.settings.classes.selected);return t.length&&t.each(function(t,e){e=s.loadOption(e),o.push(e.getValue())}),o},getDefaultValue:function(){var t=this.getDefaultInput().attr("val");return void 0!==t&&this.isMultiple()&&(t=t.split(",")),t},getWrapperOptions:function(){return this.getElements().wrapperOptions},getOptions:function(t){var e=this.getWrapperOptions().find("."+this.settings.classes.option);return void 0!==t?e.filter(t):e},selectOptions:function(t){var s=this;if(t=void 0===t||"string"==typeof t?s.getOptions(t):t,s.isMultiple())return t.length&&t.each(function(t,e){(e=s.loadOption(e)).select()}),s;s.setLog('selectOptions() works only with "multiple" attribute. Use loadOption().select() for classic <select>.',"warn")},unselectOptions:function(t,s){var o=this;if(t=void 0===t||"string"==typeof t?o.getOptions(t):t,s=s||!1,o.isMultiple())return t.length&&l.each(t,function(t,e){(e=o.loadOption(e)).isSelected()&&e.unselect(),s&&e.disable()}),0===o.getOptions(".is-selected").length&&o.reset(),o;o.setLog('removeOptions() works only with "multiple" attribute. Use loadOption().select() for classic <select>.',"warn")},getOptionFromValue:function(s){var o=this,t=o.getOptions();return t.length&&l.each(t,function(t,e){if((e=o.loadOption(e)).getValue()===s)return e}),!1},getSourceOptions:function(){return this.getElements().source.options},getSourceOptgroups:function(){return this.getElements().source.optgroups},loadOption:function(t){return"string"==typeof t&&(t=this.getOptions(t)),new l.CustomFormSelectOption(this,t)}},l.CustomFormSelectOption=function(t,e){return"object"!=typeof e||e instanceof jQuery||(e=l(e)),this.customForm=t.customForm,this.customFormSelect=t,this.option=e,this},l.CustomFormSelectOption.prototype={getOption:function(){return this.option},getInput:function(){return this.getOption().children("input")},getLabel:function(){return this.getOption().children("label")},select:function(t){var s,o=this,e={};if(t=t||{},void 0!==o.getOption()&&null!==o.getOption()&&o.getOption().length&&void 0!==o.getValue()){if(o.isDisabled()&&void 0!==t.direction)return o.option=o.getOption()["up"===t.direction?"prev":"next"](),void o.select({context:"auto-move",direction:t.direction});if(o.isDisabled())return;o.customFormSelect.isMultiple()?(s=[],1===o.customFormSelect.multipleOptions.length&&o.customFormSelect.multipleOptions[0].isFirst()&&(o.customFormSelect.multipleOptions[0].getInput().prop("checked",!1),o.customFormSelect.multipleOptions[0].removeState("selected"),o.customFormSelect.multipleOptions=[]),o.isSelected()?(o.customFormSelect.multipleOptions=[],o.getInput().prop("checked",!1),o.removeState("selected"),o.customFormSelect.getOptions("."+o.customFormSelect.settings.classes.selected).each(function(t,e){o.customFormSelect.multipleOptions.push(o.customFormSelect.loadOption(e))}),0===o.customFormSelect.multipleOptions.length&&(void 0===t.context||void 0!==t.context&&"unselect"!==t.context)&&o.customFormSelect.onReady(function(){o.customFormSelect.loadOption("."+o.customFormSelect.settings.classes.first).select(t)})):o.customFormSelect.multipleOptions.push(o),o.customFormSelect.multipleOptions.sort(function(t,e){var s=o.customFormSelect.getOptions();return(t=s.index(t))===(e=s.index(e))?0:t<e?-1:1}),o.customFormSelect.getOptions().removeClass(o.customFormSelect.settings.classes.selected),l.each(o.customFormSelect.multipleOptions,function(t,e){e.isDisabled()||(s.push(e.getName()),e.getInput().prop("checked",!0),e.addState("selected"))}),o.customFormSelect.setLabel(s),void 0!==o.customFormSelect.settings.onChange&&(e=l.extend(e,{options:o.customFormSelect.multipleOptions}))):(o.customFormSelect.setLabel(o.getName()),o.customFormSelect.getOptions().removeClass(o.customFormSelect.settings.classes.selected),o.getInput().prop("checked",!0),o.addState("selected"),void 0!==o.customFormSelect.settings.onChange&&(e=l.extend(e,{option:o}))),"init"!==t.context&&(o.getInput().triggerHandler("click"),o.getInput().triggerHandler("change"),void 0!==o.customFormSelect.settings.onChange&&(e=l.extend({customFormSelect:o.customFormSelect,elements:o.customFormSelect.getElements(),settings:t},e),o.customFormSelect.settings.onChange.call(e)))}return o},unselect:function(){return this.isSelected()&&(this.customFormSelect.isMultiple()?this.select({context:"unselect"}):this.customFormSelect.reset()),this},focus:function(t){var e=this;if(t=t||{},void 0!==e.getOption()&&null!==e.getOption()&&e.getOption().length&&void 0!==e.getValue()){if(e.isDisabled()&&void 0!==t.direction)return e.option=e.getOption()["up"===t.direction?"prev":"next"](),void e.focus({context:"auto-move",direction:t.direction});if(e.isDisabled())return;e.customFormSelect.getOptions().removeClass(e.customFormSelect.settings.classes.focused),e.isFirst()?e.customFormSelect.getToggleBtn().focus():(e.addState("focused"),e.getOption().focus())}return e},addState:function(t){return this.getOption().addClass(this.customFormSelect.settings.classes[t]),this},hasState:function(t){return this.getOption().hasClass(this.customFormSelect.settings.classes[t])},removeState:function(t){return this.getOption().removeClass(this.customFormSelect.settings.classes[t]),this},disable:function(){return this.addState("disabled")},isSelected:function(){return this.hasState("selected")},isFirst:function(){return this.hasState("first")},isLast:function(){return this.hasState("last")},isDisabled:function(){return this.hasState("disabled")},getName:function(){return this.getLabel().html()},setName:function(t){return this.getLabel().html(t),this},getValue:function(){return void 0!==this.getInput()?this.getInput().val():null},setValue:function(t){return this.getInput().val(t),this}}}(jQuery);